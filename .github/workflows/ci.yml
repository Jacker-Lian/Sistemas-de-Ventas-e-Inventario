name: Validate Frontend & Backend Build

on:
  pull_request:
    branches:
      - main
      - develop

jobs:
  validate:
    name: Validate Build
    runs-on: ubuntu-latest

    steps:
      # Clonar el repositorio
      - name: Checkout code
        uses: actions/checkout@v4

      # Configurar Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "24"
          cache: "npm"

      #  Instalar y construir el backend
      - name: Install & Build Backend
        working-directory: ./backend
        run: |
          echo "Instalando dependencias del backend..."
          npm ci
          echo "Compilando backend (si aplica)..."
          if [ -f tsconfig.json ]; then
            npm run build
          else
            echo "No se encontró tsconfig.json, se asume backend en JS puro."
          fi

      #  Instalar y construir el frontend
      - name: Clean npm cache and reinstall frontend
        working-directory: ./frontend
        run: |
          echo "Limpiando cache y reinstalando dependencias..."
          rm -rf node_modules package-lock.json
          npm install

      - name: Build Frontend
        working-directory: ./frontend
        run: |
          echo "Construyendo frontend..."
          npm run build

      #  Validar que se generó la carpeta de build
      - name: Verify Frontend Build Output
        working-directory: ./frontend
        run: |
          if [ ! -d "dist" ]; then
            echo " Error: No se encontró la carpeta dist después del build."
            exit 1
          fi
          echo " Frontend build exitoso."
